<Window x:Class="GitWrite.Views.CommitView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:c="clr-namespace:GitWrite.Controls"
        xmlns:cnv="clr-namespace:GitWrite.Views.Converters"
        mc:Ignorable="d"
        Title="CommitView"
        Width="810"
        Height="70"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        ResizeMode="NoResize"
        Background="#EEE"
        >
   <Window.Resources>
      <Style x:Key="RadialProgressBar"
             TargetType="{x:Type ProgressBar}">
         <Setter Property="Template">
            <Setter.Value>
               <ControlTemplate TargetType="{x:Type ProgressBar}">
                  <Grid>
                     <Grid.Resources>
                        <c:ProgressValueToAngleConverter x:Key="ProgressValueToAngleConverter" />
                     </Grid.Resources>

                     <c:Sector Fill="Orange">
                        <c:Sector.Angle>
                           <MultiBinding Converter="{StaticResource ProgressValueToAngleConverter}">
                              <Binding Path="Value"
                                       RelativeSource="{RelativeSource AncestorType={x:Type ProgressBar}}" />
                              <Binding Path="Minimum"
                                       RelativeSource="{RelativeSource AncestorType={x:Type ProgressBar}}" />
                              <Binding Path="Maximum"
                                       RelativeSource="{RelativeSource AncestorType={x:Type ProgressBar}}" />
                           </MultiBinding>
                        </c:Sector.Angle>
                     </c:Sector>

                     <TextBlock HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Foreground="Black"
                                Text="{Binding Value,
                                               RelativeSource={RelativeSource AncestorType={x:Type ProgressBar}}}" />
                  </Grid>
               </ControlTemplate>
            </Setter.Value>
         </Setter>
      </Style>

      <cnv:RemainingCharactersConverter x:Key="RemainingCharactersConverter" />

   </Window.Resources>
   <Grid Margin="16,12">
      <Grid.ColumnDefinitions>
         <ColumnDefinition />
         <ColumnDefinition Width="40" />
      </Grid.ColumnDefinitions>


      <Border BorderThickness="0,0,1,0"
              BorderBrush="#CCC">
         <TextBox x:Name="Commit_Subject"
                  Style="{StaticResource CommitEntryStyle}"
                  MaxLength="72" />
      </Border>

      <ProgressBar Grid.Column="1"
                   Width="40"
                   Height="40"
                   Minimum="0"
                   Maximum="{Binding MaxLength, ElementName=Commit_Subject}"
                   Value="{Binding Text.Length,
         ElementName=Commit_Subject,
         Mode=OneWay,
         Converter={StaticResource RemainingCharactersConverter},
         UpdateSourceTrigger=PropertyChanged}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Style="{StaticResource RadialProgressBar}" />
   </Grid>
</Window>
