<Window x:Class="GitWrite.Views.CommitWindow"
   x:Name="PageRoot"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
   xmlns:cmd="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Extras.WPF45"
   xmlns:gitWrite="clr-namespace:GitWrite"
   xmlns:controls="clr-namespace:GitWrite.Views.Controls"
   AllowsTransparency="True"
   Background="Transparent"
   Title="CommitWindow"
   Width="1030"
   Height="75"
   WindowStartupLocation="Manual"
   ResizeMode="NoResize"
   WindowStyle="None"
   FocusManager.FocusedElement="{Binding ElementName=CommitText}"
   DataContext="{Binding Source={StaticResource ViewModelLocator}, Path=CommitViewModel}"
   Loaded="CommitWindow_OnLoaded">
   <Window.Resources>
      <Storyboard x:Key="ExpandedStateStoryboard">
         <DoubleAnimation Storyboard.TargetName="PageRoot"
            Storyboard.TargetProperty="Height"
            From="86"
            To="400"
            Duration="0:0:0.3">
            <DoubleAnimation.EasingFunction>
               <CircleEase EasingMode="EaseOut" />
            </DoubleAnimation.EasingFunction>
         </DoubleAnimation>
         <DoubleAnimation Storyboard.TargetName="SecondaryCommitGrid"
            Storyboard.TargetProperty="Opacity"
            From="0"
            To="1"
            Duration="0:0:0.4" />
      </Storyboard>
      <Storyboard x:Key="SaveCommitStoryboard"
         Duration="0:0:0.6">
         <ObjectAnimationUsingKeyFrames Storyboard.TargetName="CommitStateBorder"
            Storyboard.TargetProperty="Visibility">
            <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}" />
         </ObjectAnimationUsingKeyFrames>
         <DoubleAnimation Storyboard.TargetName="IconCircle"
            Storyboard.TargetProperty="Width"
            From="0"
            To="50"
            Duration="0:0:0.4">
            <DoubleAnimation.EasingFunction>
               <BackEase EasingMode="EaseOut" />
            </DoubleAnimation.EasingFunction>
         </DoubleAnimation>
         <DoubleAnimation Storyboard.TargetName="IconCircle"
            Storyboard.TargetProperty="Height"
            From="0"
            To="50"
            Duration="0:0:0.4">
            <DoubleAnimation.EasingFunction>
               <BackEase EasingMode="EaseOut" />
            </DoubleAnimation.EasingFunction>
         </DoubleAnimation>
      </Storyboard>
      <Storyboard x:Key="AbortCommitStoryboard"
         Duration="0:0:0.6">
         <ObjectAnimationUsingKeyFrames Storyboard.TargetName="AbortStateBorder"
            Storyboard.TargetProperty="Visibility">
            <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}" />
         </ObjectAnimationUsingKeyFrames>
         <DoubleAnimation Storyboard.TargetName="AbortIconCircle"
            Storyboard.TargetProperty="Width"
            From="0"
            To="50"
            Duration="0:0:0.4">
            <DoubleAnimation.EasingFunction>
               <BackEase EasingMode="EaseOut" />
            </DoubleAnimation.EasingFunction>
         </DoubleAnimation>
         <DoubleAnimation Storyboard.TargetName="AbortIconCircle"
            Storyboard.TargetProperty="Height"
            From="0"
            To="50"
            Duration="0:0:0.4">
            <DoubleAnimation.EasingFunction>
               <BackEase EasingMode="EaseOut" />
            </DoubleAnimation.EasingFunction>
         </DoubleAnimation>
      </Storyboard>
   </Window.Resources>

   <Border x:Name="OuterBorder"
      CornerRadius="14"
      Padding="10"
      Background="{StaticResource WindowOuterBorderColor}">
      <Grid VerticalAlignment="Stretch">
         <Border x:Name="InnerBorder"
            CornerRadius="8"
            Padding="12"
            VerticalAlignment="Stretch"
            Background="{StaticResource WindowBackgroundColor}">
            <Grid VerticalAlignment="Stretch">
               <Grid.RowDefinitions>
                  <RowDefinition Height="30" />
                  <RowDefinition Height="8" />
                  <RowDefinition Height="*" />
               </Grid.RowDefinitions>

               <Grid x:Name="PrimaryCommitNotesGrid" Grid.Row="0">
                  <TextBox x:Name="CommitText"
                     Background="{StaticResource WindowCommitBackgroundColor}"
                     Foreground="{StaticResource WindowCommitForegroundColor}"
                     FontFamily="Consolas"
                     FontSize="24"
                     MaxLength="72"
                     VerticalContentAlignment="Center"
                     Text="{Binding ShortMessage, UpdateSourceTrigger=PropertyChanged}">
                     <i:Interaction.Triggers>
                        <i:EventTrigger EventName="KeyDown">
                           <cmd:EventToCommand Command="{Binding CommitNotesKeyDownCommand}"
                              PassEventArgsToCommand="True"
                              MustToggleIsEnabledValue="True" />
                        </i:EventTrigger>
                        <i:EventTrigger EventName="GotFocus">
                           <cmd:EventToCommand Command="{Binding OnPrimaryMessageGotFocusCommand}"
                              MustToggleIsEnabledValue="True" />
                        </i:EventTrigger>
                     </i:Interaction.Triggers>
                  </TextBox>

                  <TextBlock x:Name="RemainingCharactersTextBlock"
                     HorizontalAlignment="Right"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"
                     Foreground="{StaticResource WindowCommitForegroundColor}"
                     FontStyle="Italic"
                     Text="{Binding Text.Length, ElementName=CommitText, Converter={StaticResource TextLengthInversionConverter}}" />
               </Grid>

               <Grid x:Name="SecondaryCommitGrid"
                  Grid.Row="2"
                  VerticalAlignment="Stretch">
                  <TextBox x:Name="SecondaryCommitText"
                     Background="{StaticResource WindowCommitBackgroundColor}"
                     Foreground="{StaticResource WindowCommitForegroundColor}"
                     FontFamily="Consolas"
                     FontSize="24"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Text="{Binding ExtraCommitText, UpdateSourceTrigger=PropertyChanged}">
                     <i:Interaction.Triggers>
                        <i:EventTrigger EventName="KeyDown">
                           <cmd:EventToCommand Command="{Binding CommitNotesKeyDownCommand}"
                              PassEventArgsToCommand="True"
                              MustToggleIsEnabledValue="True" />
                        </i:EventTrigger>
                        <i:EventTrigger EventName="GotFocus">
                           <cmd:EventToCommand Command="{Binding OnSecondaryNotesGotFocusCommand}"
                              MustToggleIsEnabledValue="True" />
                        </i:EventTrigger>
                     </i:Interaction.Triggers>
                  </TextBox>
               </Grid>
            </Grid>
         </Border>

         <controls:ExitPanel />
      </Grid>
   </Border>
</Window>
