<Window x:Class="GitWrite.Views.CommitWindow"
   x:Name="PageRoot"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
   xmlns:cmd="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Extras.WPF45"
   xmlns:views="clr-namespace:GitWrite.Views"
   xmlns:behaviors="clr-namespace:GitWrite.Behaviors"
   AllowsTransparency="True"
   Background="Transparent"
   Title="CommitWindow"
   Width="1036"
   Height="{x:Static views:WindowValues.NonExpandedHeight}"
   WindowStartupLocation="Manual"
   ResizeMode="NoResize"
   WindowStyle="None"
   FocusManager.FocusedElement="{Binding ElementName=CommitText}"
   DataContext="{Binding Source={StaticResource ViewModelLocator}, Path=CommitViewModel}"
   Loaded="CommitWindow_OnLoaded">

   <Window.Resources>
      <ResourceDictionary>
         <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="..\Styles\TextBoxStyle.xaml" />
            <ResourceDictionary Source="..\Styles\ButtonStyle.xaml" />
            <ResourceDictionary Source="CommitWindowResources.xaml" />
         </ResourceDictionary.MergedDictionaries>
      </ResourceDictionary>
   </Window.Resources>

   <i:Interaction.Behaviors>
      <behaviors:CommitCaretPositionBehavior />
      <behaviors:CommitKeyPressBehavior />
      <behaviors:WindowPlacementBehavior />
   </i:Interaction.Behaviors>

   <Window.Triggers>
      <EventTrigger RoutedEvent="Window.Loaded">
         <BeginStoryboard Storyboard="{StaticResource WindowEntranceStoryboard}" />
      </EventTrigger>
   </Window.Triggers>

   <i:Interaction.Triggers>
      <i:EventTrigger EventName="Closing">
         <cmd:EventToCommand Command="{Binding CloseCommand, Mode=OneTime}"
            PassEventArgsToCommand="True"
            MustToggleIsEnabledValue="True" />
      </i:EventTrigger>
   </i:Interaction.Triggers>

   <Window.Effect>
      <DropShadowEffect BlurRadius="4"
         ShadowDepth="5"
         Direction="270"
         Opacity="0.6" />
   </Window.Effect>

   <Grid x:Name="MainGrid">
      <VisualStateManager.VisualStateGroups>
         <VisualStateGroup x:Name="ExpansionStates">
            <VisualStateGroup.Transitions>
               <VisualTransition GeneratedDuration="0:0:0.3" To="Expanded">
                  <VisualTransition.GeneratedEasingFunction>
                     <CircleEase EasingMode="EaseOut" />
                  </VisualTransition.GeneratedEasingFunction>
               </VisualTransition>
            </VisualStateGroup.Transitions>

            <VisualState x:Name="Collapsed" />
            <VisualState x:Name="Expanded">
               <Storyboard>
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Height"
                     Duration="0"
                     To="{x:Static views:WindowValues.ExpandedHeight}" />
               </Storyboard>
            </VisualState>
         </VisualStateGroup>
      </VisualStateManager.VisualStateGroups>

      <Border x:Name="OuterBorder"
         Margin="0,0,0,10"
         CornerRadius="14"
         Background="{StaticResource WindowOuterBorderColor}"
         BorderThickness="2"
         BorderBrush="{StaticResource WindowCommitBackgroundColor}">
         <Grid>
            <Grid.RenderTransform>
               <TranslateTransform x:Name="OuterBorderTranslateTransform" />
            </Grid.RenderTransform>

            <Grid.ColumnDefinitions>
               <ColumnDefinition />
               <ColumnDefinition Width="40" />
            </Grid.ColumnDefinitions>

            <Border x:Name="InnerBorder"
               CornerRadius="8"
               Padding="16"
               VerticalAlignment="Stretch">
               <Grid VerticalAlignment="Stretch">
                  <Grid.RowDefinitions>
                     <RowDefinition Height="30" />
                     <RowDefinition Height="30" />
                     <RowDefinition Height="*" />
                  </Grid.RowDefinitions>

                  <Grid x:Name="PrimaryCommitNotesGrid" Grid.Row="0">
                     <TextBox x:Name="CommitText"  
                        Background="Transparent"
                        Foreground="{StaticResource WindowCommitForegroundColor}"
                        FontFamily="Consolas"
                        FontSize="24"
                        MaxLength="72"
                        Text="{Binding ShortMessage, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                           <i:EventTrigger EventName="GotFocus">
                              <cmd:EventToCommand Command="{Binding PrimaryMessageGotFocusCommand, Mode=OneTime}"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                        </i:Interaction.Triggers>
                     </TextBox>
                  </Grid>

                  <Rectangle Grid.Row="1"
                     Height="1"
                     Fill="{StaticResource WindowCommitBackgroundColor}" />

                  <Grid x:Name="SecondaryCommitGrid"
                     Grid.Row="2"
                     VerticalAlignment="Stretch">
                     <TextBox x:Name="SecondaryCommitText"
                        Foreground="{StaticResource WindowCommitForegroundColor}"
                        Background="Transparent"
                        FontFamily="Consolas"
                        FontSize="24"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        Text="{Binding ExtraCommitText, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                           <i:EventTrigger EventName="KeyDown">
                              <cmd:EventToCommand Command="{Binding CommitNotesKeyDownCommand, Mode=OneTime}"
                                 PassEventArgsToCommand="True"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                           <i:EventTrigger EventName="GotFocus">
                              <cmd:EventToCommand Command="{Binding SecondaryNotesGotFocusCommand, Mode=OneTime}"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                        </i:Interaction.Triggers>
                     </TextBox>
                  </Grid>
               </Grid>
            </Border>

            <Grid Grid.Column="1">
               <Grid.RowDefinitions>
                  <RowDefinition Height="30" />
                  <RowDefinition />
                  <RowDefinition Height="30" />
               </Grid.RowDefinitions>

               <Border CornerRadius="0,12,0,0">
                  <TextBlock x:Name="RemainingCharactersTextBlock"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     Margin="0,10,0,0"
                     Foreground="{StaticResource WindowCommitForegroundColor}"
                     FontStyle="Italic"
                     Text="{Binding Text.Length, ElementName=CommitText, Converter={StaticResource TextLengthInversionConverter}}" />
               </Border>

               <Button Grid.Row="2"
                  Foreground="{StaticResource WindowCommitForegroundColor}"
                  Content="?"
                  IsTabStop="False"
                  Command="{Binding HelpCommand, Mode=OneTime}"/>
            </Grid>
         </Grid>
      </Border>
   </Grid>
</Window>
