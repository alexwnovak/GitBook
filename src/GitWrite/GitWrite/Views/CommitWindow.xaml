<Window x:Class="GitWrite.Views.CommitWindow"
   x:Name="PageRoot"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
   xmlns:cmd="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Extras.WPF45"
   xmlns:gitWrite="clr-namespace:GitWrite"
   xmlns:controls="clr-namespace:GitWrite.Views.Controls"
   xmlns:views="clr-namespace:GitWrite.Views"
   AllowsTransparency="True"
   Background="Transparent"
   Title="CommitWindow"
   Width="1036"
   Height="76"
   WindowStartupLocation="Manual"
   ResizeMode="NoResize"
   WindowStyle="None"
   FocusManager.FocusedElement="{Binding ElementName=CommitText}"
   DataContext="{Binding Source={StaticResource ViewModelLocator}, Path=CommitViewModel}"
   Loaded="CommitWindow_OnLoaded">

   <i:Interaction.Behaviors>
      <views:WindowDragBehavior />
   </i:Interaction.Behaviors>

   <Window.InputBindings>
      <KeyBinding Gesture="Enter" Command="{Binding SaveCommand, Mode=OneTime}" />
      <KeyBinding Gesture="Ctrl+Enter" Command="{Binding SaveCommand, Mode=OneTime}" />
      <KeyBinding Gesture="Escape" Command="{Binding AbortCommand, Mode=OneTime}" />
   </Window.InputBindings>

   <Window.Resources>
      <ResourceDictionary>
         <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="..\Styles\TextBoxStyle.xaml" />
            <ResourceDictionary>
               <Storyboard x:Key="WindowEntranceStoryboard">
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Top"
                     From="{x:Static views:WindowLocation.StartingPointY}"
                     To="{x:Static views:WindowLocation.RestingPointY}"
                     Duration="0:0:0.3">
                     <DoubleAnimation.EasingFunction>
                        <CircleEase EasingMode="EaseOut" />
                     </DoubleAnimation.EasingFunction>
                  </DoubleAnimation>
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Opacity"
                     From="0"
                     To="1"
                     Duration="0:0:0.3" />
               </Storyboard>
               <Storyboard x:Key="WindowExitStoryboard">
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Top"
                     From="{x:Static views:WindowLocation.RestingPointY}"
                     To="{x:Static views:WindowLocation.StartingPointY}"
                     Duration="0:0:0.3">
                     <DoubleAnimation.EasingFunction>
                        <CircleEase EasingMode="EaseOut" />
                     </DoubleAnimation.EasingFunction>
                  </DoubleAnimation>
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Opacity"
                     From="1"
                     To="0"
                     Duration="0:0:0.3">
                     <DoubleAnimation.EasingFunction>
                        <CircleEase EasingMode="EaseOut" />
                     </DoubleAnimation.EasingFunction>
                  </DoubleAnimation>
               </Storyboard>
               <Storyboard x:Key="ExpandedStateStoryboard">
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Height"
                     To="400"
                     Duration="0:0:0.3">
                     <DoubleAnimation.EasingFunction>
                        <CircleEase EasingMode="EaseOut" />
                     </DoubleAnimation.EasingFunction>
                  </DoubleAnimation>
                  <DoubleAnimation Storyboard.TargetName="SecondaryCommitGrid"
                     Storyboard.TargetProperty="Opacity"
                     From="0"
                     To="1"
                     Duration="0:0:0.3" />
               </Storyboard>

            </ResourceDictionary>
         </ResourceDictionary.MergedDictionaries>
      </ResourceDictionary>
   </Window.Resources>

   <Window.Effect>
      <DropShadowEffect BlurRadius="4"
         ShadowDepth="5"
         Direction="270"
         Opacity="0.6" />
   </Window.Effect>

   <Grid x:Name="MainGrid">
      <Border x:Name="OuterBorder"
         Margin="0,0,0,10"
         CornerRadius="14"
         Background="{StaticResource WindowOuterBorderColor}"
         BorderThickness="2"
         BorderBrush="{StaticResource WindowCommitBackgroundColor}">
         <Grid>
            <Grid.ColumnDefinitions>
               <ColumnDefinition />
               <ColumnDefinition Width="40" />
            </Grid.ColumnDefinitions>

            <Border x:Name="InnerBorder"
               CornerRadius="8"
               Padding="16"
               VerticalAlignment="Stretch">
               <Grid VerticalAlignment="Stretch">
                  <Grid.RowDefinitions>
                     <RowDefinition Height="30" />
                     <RowDefinition Height="8" />
                     <RowDefinition Height="*" />
                  </Grid.RowDefinitions>

                  <Grid x:Name="PrimaryCommitNotesGrid" Grid.Row="0">
                     <TextBox x:Name="CommitText"  
                        Background="Transparent"
                        Foreground="{StaticResource WindowCommitForegroundColor}"
                        FontFamily="Consolas"
                        FontSize="24"
                        MaxLength="72"
                        Text="{Binding ShortMessage, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                           <i:EventTrigger EventName="KeyDown">
                              <cmd:EventToCommand Command="{Binding CommitNotesKeyDownCommand, Mode=OneTime}"
                                 PassEventArgsToCommand="True"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                           <i:EventTrigger EventName="GotFocus">
                              <cmd:EventToCommand Command="{Binding PrimaryMessageGotFocusCommand, Mode=OneTime}"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                        </i:Interaction.Triggers>
                     </TextBox>
                  </Grid>

                  <Grid x:Name="SecondaryCommitGrid"
                     Grid.Row="2"
                     VerticalAlignment="Stretch">
                     <TextBox x:Name="SecondaryCommitText"
                        Foreground="{StaticResource WindowCommitForegroundColor}"
                        Background="Transparent"
                        FontFamily="Consolas"
                        FontSize="24"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        Text="{Binding ExtraCommitText, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                           <i:EventTrigger EventName="KeyDown">
                              <cmd:EventToCommand Command="{Binding CommitNotesKeyDownCommand, Mode=OneTime}"
                                 PassEventArgsToCommand="True"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                           <i:EventTrigger EventName="GotFocus">
                              <cmd:EventToCommand Command="{Binding SecondaryNotesGotFocusCommand, Mode=OneTime}"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                        </i:Interaction.Triggers>
                     </TextBox>
                  </Grid>
               </Grid>
            </Border>

            <Grid Grid.Column="1">
               <TextBlock x:Name="RemainingCharactersTextBlock"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Margin="0,10,0,0"
                  Foreground="{StaticResource WindowCommitForegroundColor}"
                  FontStyle="Italic"
                  Text="{Binding Text.Length, ElementName=CommitText, Converter={StaticResource TextLengthInversionConverter}}" />

               <TextBlock HorizontalAlignment="Center"
                  VerticalAlignment="Bottom"
                  Margin="0,0,0,10"
                  Foreground="{StaticResource WindowCommitForegroundColor}"
                  Text="?" />
            </Grid>
         </Grid>
      </Border>
   </Grid>
</Window>
