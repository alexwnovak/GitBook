<views:WindowBase x:Class="GitWrite.Views.CommitWindow"
   x:Name="PageRoot"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
   xmlns:cmd="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Extras.WPF45"
   xmlns:views="clr-namespace:GitWrite.Views"
   xmlns:behaviors="clr-namespace:GitWrite.Behaviors"
   AllowsTransparency="True"
   Background="Transparent"
   Title="{Binding Title}"
   Width="1054"
   Height="{x:Static views:WindowValues.NonExpandedHeight}"
   ResizeMode="NoResize"
   WindowStyle="None"
   FocusManager.FocusedElement="{Binding ElementName=CommitText}"
   CommandManager.PreviewCanExecute="CommitWindow_OnPreviewCanExecute"
   DataContext="{Binding CommitViewModel, Source={StaticResource ViewModelLocator}}">

   <Window.Resources>
      <ResourceDictionary>
         <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="..\Styles\TextBoxStyle.xaml" />
            <ResourceDictionary Source="..\Styles\ButtonStyle.xaml" />
            <ResourceDictionary Source="CommitWindowResources.xaml" />
         </ResourceDictionary.MergedDictionaries>
      </ResourceDictionary>
   </Window.Resources>

   <i:Interaction.Behaviors>
      <behaviors:CommitCaretPositionBehavior />
   </i:Interaction.Behaviors>

   <i:Interaction.Triggers>
      <i:EventTrigger EventName="Loaded">
         <cmd:EventToCommand Command="{Binding LoadCommand, Mode=OneTime}" />
      </i:EventTrigger>
   </i:Interaction.Triggers>

   <Grid x:Name="MainGrid">
      <VisualStateManager.VisualStateGroups>
         <VisualStateGroup x:Name="ExpansionStates">
            <VisualStateGroup.Transitions>
               <VisualTransition GeneratedDuration="0:0:0.3" To="Expanded">
                  <VisualTransition.GeneratedEasingFunction>
                     <CircleEase EasingMode="EaseOut" />
                  </VisualTransition.GeneratedEasingFunction>
               </VisualTransition>
            </VisualStateGroup.Transitions>

            <VisualState x:Name="Collapsed" />
            <VisualState x:Name="Expanded">
               <Storyboard>
                  <DoubleAnimation Storyboard.TargetName="PageRoot"
                     Storyboard.TargetProperty="Height"
                     Duration="0"
                     To="{x:Static views:WindowValues.ExpandedHeight}" />
               </Storyboard>
            </VisualState>
         </VisualStateGroup>
      </VisualStateManager.VisualStateGroups>

      <Border x:Name="OuterBorder"
         CornerRadius="14"
         Height="56"
         Background="{DynamicResource WindowBackgroundColor}"
         BorderThickness="2"
         BorderBrush="{DynamicResource WindowBorderColor}">
         <Grid>
            <Grid.RenderTransform>
               <TranslateTransform x:Name="OuterBorderTranslateTransform" />
            </Grid.RenderTransform>

            <Border x:Name="InnerBorder"
               CornerRadius="8"
               Padding="11"
               VerticalAlignment="Stretch">
               <Grid VerticalAlignment="Stretch">
                  <Grid.RowDefinitions>
                     <RowDefinition Height="30" />
                     <RowDefinition Height="30" />
                     <RowDefinition Height="*" />
                  </Grid.RowDefinitions>

                  <Grid x:Name="PrimaryCommitNotesGrid" Grid.Row="0">
                     <TextBox x:Name="CommitText"  
                        Background="Transparent"
                        Foreground="{DynamicResource TextColor}"
                        FontFamily="Consolas"
                        FontSize="24"
                        MaxLength="72"
                        Text="{Binding ShortMessage, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                           <i:EventTrigger EventName="GotFocus">
                              <cmd:EventToCommand Command="{Binding PrimaryMessageGotFocusCommand, Mode=OneTime}"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                        </i:Interaction.Triggers>
                     </TextBox>

                     <TextBlock HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,4,0"
                        Foreground="{DynamicResource TextColor}"
                        FontStyle="Italic"
                        Text="{Binding Text.Length, ElementName=CommitText, Converter={StaticResource TextLengthInversionConverter}}" />
                  </Grid>

                  <Rectangle Grid.Row="1"
                     Height="1"
                     Fill="{DynamicResource SeparatorColor}" />

                  <Grid x:Name="SecondaryCommitGrid"
                     Grid.Row="2"
                     VerticalAlignment="Stretch">
                     <TextBox x:Name="SecondaryCommitText"
                        Foreground="{DynamicResource TextColor}"
                        Background="Transparent"
                        FontFamily="Consolas"
                        FontSize="24"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        Text="{Binding ExtraCommitText, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                           <i:EventTrigger EventName="GotFocus">
                              <cmd:EventToCommand Command="{Binding SecondaryNotesGotFocusCommand, Mode=OneTime}"
                                 MustToggleIsEnabledValue="True" />
                           </i:EventTrigger>
                        </i:Interaction.Triggers>
                     </TextBox>
                  </Grid>
               </Grid>
            </Border>
         </Grid>
      </Border>
   </Grid>
</views:WindowBase>
